<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Security Bathroom Tracker</title>
    <link rel="stylesheet" href="css/main.css" />
  </head>
  <body>
    <header>Security Bathroom Tracker</header>

    <form
      class="panel"
      id="bathroom-tracker"
      action="https://script.google.com/macros/s/AKfycbyfgyRcACCIHC_qGMT_5vc8m0iwT40pA2Ik25i5DAuQ5BAZKsyM6u_klJ_PU1xO2HoG/exec"
      method="POST"
    >
      <!-- Name Field -->
      <section class="name-input">
        <label id="id-name-input" for="staffName">Your Name:</label>
        <input
          type="text"
          id="staffName"
          name="Name"
          placeholder="Enter your name"
          required
        />
      </section>

      <section class="gender-input">
        <label>Bathroom Type:</label><br />
        <label>
          <input type="radio" name="Gender" value="Girls" required />
          Girls
        </label>
        <label>
          <input type="radio" name="Gender" value="Boys" required />
          Boys
        </label>
      </section>

      <!-- Location Buttons (each one submits the form) -->
      <main>
        <button type="submit" name="Location" value="1st Floor Maint T BR">
          1st Floor Maint T BR
        </button>
        <button type="submit" name="Location" value="1st Floor Elv T BR">
          1st Floor Elv T BR
        </button>
        <button type="submit" name="Location" value="300 POD BR">
          300 POD BR
        </button>
        <button type="submit" name="Location" value="500 POD BR">
          500 POD BR
        </button>
        <button type="submit" name="Location" value="2nd Floor Maint T BR">
          2nd Floor Maint T BR
        </button>
        <button type="submit" name="Location" value="2nd Floor Elv T BR">
          2nd Floor Elv T BR
        </button>
        <button type="submit" name="Location" value="400 POD  BR">
          400 POD BR
        </button>
        <button type="submit" name="Location" value="600 POD BR">
          600 POD BR
        </button>
      </main>
    </form>

    <script>
      (function () {
        const WEB_APP_URL =
          "https://script.google.com/macros/s/AKfycbyfgyRcACCIHC_qGMT_5vc8m0iwT40pA2Ik25i5DAuQ5BAZKsyM6u_klJ_PU1xO2HoG/exec";

        const form = document.getElementById("bathroom-tracker");
        const nameInput = document.getElementById("staffName");

        // Prefill saved name from localStorage
        nameInput.value = localStorage.getItem("user-name") || "";

        // Prefill saved gender from localStorage
        const savedGender = localStorage.getItem("user-gender");
        if (savedGender) {
          const genderRadio = document.querySelector(
            `input[name="Gender"][value="${savedGender}"]`
          );
          if (genderRadio) genderRadio.checked = true;
        }

        // Tiny inline toast
        const toast = document.createElement("div");
        toast.style.position = "fixed";
        toast.style.bottom = "16px";
        toast.style.left = "50%";
        toast.style.transform = "translateX(-50%)";
        toast.style.padding = "8px 12px";
        toast.style.borderRadius = "10px";
        toast.style.fontSize = "0.9rem";
        toast.style.background = "rgba(0,0,0,0.7)";
        toast.style.color = "#fff";
        toast.style.opacity = "0";
        toast.style.transition = "opacity 180ms ease";
        document.body.appendChild(toast);
        function showToast(msg) {
          toast.textContent = msg;
          toast.style.opacity = "1";
          setTimeout(() => (toast.style.opacity = "0"), 1000);
        }

        // Intercept submit
        form.addEventListener("submit", function (e) {
          e.preventDefault();

          const submitter = e.submitter;
          const locationValue =
            submitter && submitter.name === "Location" ? submitter.value : "";

          const nameValue = (nameInput.value || "").trim();
          const genderRadio = document.querySelector(
            'input[name="Gender"]:checked'
          );
          const genderValue = genderRadio ? genderRadio.value : "";

          if (!nameValue) {
            nameInput.focus();
            showToast("Enter name first");
            return;
          }
          if (!genderValue) {
            showToast("Select Girls or Boys");
            return;
          }
          if (!locationValue) {
            showToast("Pick a location");
            return;
          }

          // Build URL-encoded body
          const params = new URLSearchParams();
          params.append("Name", nameValue);
          params.append("Location", locationValue);
          params.append("Gender", genderValue);

          fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: params.toString(),
          }).catch(() => {});

          // Save name & gender for next time
          localStorage.setItem("user-name", nameValue);
          localStorage.setItem("user-gender", genderValue);

          // Reset radios/other fields, keep name & gender prefilled
          form.reset();
          nameInput.value = nameValue;
          const restoreGender = document.querySelector(
            `input[name="Gender"][value="${genderValue}"]`
          );
          if (restoreGender) restoreGender.checked = true;

          nameInput.focus();
          showToast("Recorded");
        });
      })();
    </script>
  </body>
</html>
